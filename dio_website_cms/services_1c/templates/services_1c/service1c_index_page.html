{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block content %}
  <section class="section pt-10">
    <div class="container ">
      <!-- Заголовок + кнопка -->
      <div class="header mb-0 pt-0">
        <h2 class="heading_h3  font-bold">Сервисы 1С</h2>
      </div>

      <!-- ФИЛЬТРЫ -->
        <div class="flex flex-wrap justify-center gap-4 sm:gap-6 mb-12">
            <a href="?category=all"
               class="group relative px-5 py-2 transition-all duration-300 heading_h5  z-20">
                Все сервисы
                <span class="absolute -bottom-1 left-0 h-0.5 bg-gradient-to-r from-red-700 to-red-900 rounded-full transition-all duration-300
                    {% if current_category == 'all' or not current_category %}w-full{% else %}w-0 group-hover:w-full{% endif %}"></span>
            </a>

            {% for value, label in SERVICE_CATEGORY_CHOICES %}
            <a href="?category={{ value }}"
               class="group relative px-5 py-2 transition-all duration-300 heading_h5  z-20">
                {{ label }}
                <span class="absolute -bottom-1 left-0 h-0.5 bg-gradient-to-r from-red-700 to-red-900 rounded-full transition-all duration-300
                    {% if current_category == value %}w-full{% else %}w-0 group-hover:w-full{% endif %}"></span>
            </a>
            {% endfor %}
        </div>

      <!-- Сетка сервисов -->
      <div class="w-layout-grid grid_3-col gap-2 lg:gap-3 mt-12">
        {% for service in 1c_services %}
          <a href="{{ service.url }}" class="card relative overflow-hidden rounded-xl shadow-lg group" style="height: 400px;">
            <!-- Фоновое изображение с анимацией -->
            {% if service.image %}
              {% image service.image fill-600x400 class="w-full h-full object-cover absolute top-0 left-0 z-0 transition-transform duration-1000 group-hover:scale-125" %}
            {% endif %}
            <div class="relative z-10 flex flex-col justify-between h-full p-6 bg-black/15 text-white">
              <!-- Верхняя часть: Категория -->
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                  <!-- Технологии можно добавить позже -->
                </div>
                <span class="px-2 py-1 rounded-full bg-red-600/50 text-white text-xs font-medium">
                  {{ service.get_category_display }}
                </span>
              </div>

              <div class="space-y-4 flex-grow">
                <h3 class="heading_h4 text-white">{{ service.headline }}</h3>
                <p class="subheading text-gray-200">
                  {{ service.intro|striptags|truncatewords:14 }}
                </p>
              </div>

              <div class="mt-auto text-white text-sm font-medium">
                Подробнее
                <svg class="w-4 h-4 ml-1 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
              </div>
            </div>
          </a>
        {% empty %}
          <div class="col-span-3 text-center py-12">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 text-blue-600 rounded-full mb-4">
              <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">Сервисов 1С пока нет</h3>
            <p class="text-gray-500 max-w-md mx-auto">Скоро здесь появятся наши сервисы 1С.</p>
          </div>
        {% endfor %}
      </div>

      <!-- Пагинация -->
      {% if 1c_services.has_other_pages %}
        <div class="text-center mt-12">
          <ul class="inline-flex gap-2">
            {% if 1c_services.has_previous %}
              <li>
                <a href="?page={{ 1c_services.previous_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}" class="px-4 py-2 rounded-full bg-gray-200 text-gray-700 hover:bg-blue-600 hover:text-white">
                  Предыдущая
                </a>
              </li>
            {% endif %}
            {% for num in 1c_services.paginator.page_range %}
              <li>
                <a href="?page={{ num }}{% if current_category %}&category={{ current_category }}{% endif %}" class="px-4 py-2 rounded-full {% if 1c_services.number == num %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700{% endif %} hover:bg-blue-600 hover:text-white">
                  {{ num }}
                </a>
              </li>
            {% endfor %}
            {% if 1c_services.has_next %}
              <li>
                <a href="?page={{ 1c_services.next_page_number }}{% if current_category %}&category={{ current_category }}{% endif %}" class="px-4 py-2 rounded-full bg-gray-200 text-gray-700 hover:bg-blue-600 hover:text-white">
                  Следующая
                </a>
              </li>
            {% endif %}
          </ul>
        </div>
      {% endif %}
    </div>
  </section>

  <style>
    .grid_3-col {
      grid-template-columns: repeat(3, 1fr);
    }

    .mb-8 {
      margin-bottom: 2rem;
    }

    .rich-text.w-richtext {
      max-width: 800px;
      margin: 0 auto;
    }

    .prose {
      color: #4B5563;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate-fadeInUp {
      animation: fadeInUp 0.8s ease-out forwards;
    }

    .line-clamp-2, .line-clamp-3 {
      display: -webkit-box;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .line-clamp-2 { -webkit-line-clamp: 2; }
    .line-clamp-3 { -webkit-line-clamp: 3; }

    /* Responsive Grid */
    @media (max-width: 900px) {
      .grid_3-col {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 600px) {
      .grid_3-col {
        grid-template-columns: 1fr;
      }
    }

    /* Centering */
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const element = entry.target;
            const delay = parseInt(element.getAttribute('data-delay') || '0') * 100;
            setTimeout(() => {
              element.classList.add("animate-fadeInUp");
            }, delay);
          }
        });
      }, { threshold: 0.1 });

      document.querySelectorAll("[data-animate]:not([data-animated])").forEach(item => observer.observe(item));
    });
  </script>
{% endblock %}