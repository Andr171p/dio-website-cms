{% load static %}

<div class="w-form heading_h5">
    <form id="vacancyForm" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}
        
        <input type="hidden" name="title" id="id_title" value="{{ page.title }}">
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="id_name" class="block text-sm font-medium text-gray-300 mb-2">–ò–º—è *</label>
                <input type="text" name="name" id="id_name" 
                       class="w-full px-4 py-3 bg-white/5 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-red-500 focus:ring-2 focus:ring-red-500/20 transition-all duration-300"
                       placeholder="–í–∞—à–µ –∏–º—è" required>
            </div>
            
            <div>
                <label for="id_phone" class="block text-sm font-medium text-gray-300 mb-2">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                <input type="tel" name="phone" id="id_phone" 
                       class="w-full px-4 py-3 bg-white/5 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-red-500 focus:ring-2 focus:ring-red-500/20 transition-all duration-300"
                       placeholder="+7 (___) ___-__-__" required>
            </div>
        </div>

        <div>
            <label for="id_email" class="block text-sm font-medium text-gray-300 mb-2">Email</label>
            <input type="email" name="email" id="id_email" 
                   class="w-full px-4 py-3 bg-white/5 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-red-500 focus:ring-2 focus:ring-red-500/20 transition-all duration-300"
                   placeholder="your@email.com">
        </div>

        <div>
            <label for="id_resume" class="block text-sm font-medium text-gray-300 mb-2">–†–µ–∑—é–º–µ *</label>
            <div class="flex items-center space-x-4">
                <input type="file" name="resume" id="id_resume" 
                       class="flex-1 px-4 py-3 bg-white/5 border border-gray-600 rounded-lg text-white file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-red-600 file:text-white hover:file:bg-red-700 transition-all duration-300"
                       accept=".pdf,.doc,.docx,.txt" required>
            </div>
            <small class="text-gray-400 text-sm mt-2 block">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: PDF, DOC, DOCX, TXT (–º–∞–∫—Å. 5MB)</small>
        </div>

        <div>
            <label for="id_message" class="block text-sm font-medium text-gray-300 mb-2">–°–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ</label>
            <textarea name="message" id="id_message" rows="4"
                      class="w-full px-4 py-3 bg-white/5 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:border-red-500 focus:ring-2 focus:ring-red-500/20 transition-all duration-300"
                      placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ –∏ –ø–æ—á–µ–º—É –≤—ã —Ö–æ—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∞–º–∏..."></textarea>
        </div>

        <div class="flex items-start space-x-3">
            <input type="checkbox" name="agreement" id="agreement" required
                   class="w-4 h-4 mt-1 text-red-600 bg-white/5 border-gray-600 rounded focus:ring-red-500 focus:ring-2">
            <label for="agreement" class="text-sm text-gray-300">
                –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
            </label>
        </div>
        
        <input type="hidden" name="csrftoken" id="id_csrftoken" value="">
        
        <button type="submit" id="submitBtn"
                class="w-full bg-red-600 text-white py-4 px-6 rounded-lg font-semibold hover:bg-red-700 transition-all duration-300 shadow-lg cursor-pointer">
            –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—é–º–µ
            <svg class="w-5 h-5 ml-2 inline-block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
            </svg>
        </button>
    </form>
</div>

<!-- –ü–†–û–°–¢–ê–Ø –¢–ï–°–¢–û–í–ê–Ø –§–û–†–ú–ê -->
<div style="border: 3px solid blue; padding: 20px; margin: 20px 0; background: #1a1a1a;">
    <h3 style="color: blue; text-align: center;">–¢–ï–°–¢–û–í–ê–Ø –§–û–†–ú–ê - –î–û–õ–ñ–ù–ê –†–ê–ë–û–¢–ê–¢–¨</h3>
    <form id="testForm">
        {% csrf_token %}
        <input type="text" placeholder="–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ" style="width: 100%; padding: 10px; margin: 10px 0;">
        <button type="submit" style="width: 100%; padding: 15px; background: blue; color: white; border: none; cursor: pointer;">
            –¢–ï–°–¢–û–í–ê–Ø –ö–ù–û–ü–ö–ê - –ù–ê–ñ–ú–ò –ú–ï–ù–Ø
        </button>
    </form>
</div>

<script>
// ================= –ü–†–û–°–¢–û–ô –¢–ï–°–¢ =================
console.log('=== –°–ö–†–ò–ü–¢ –§–û–†–ú–´ –ó–ê–ì–†–£–ñ–ï–ù ===');

// –¢–µ—Å—Ç–æ–≤–∞—è —Ñ–æ—Ä–º–∞
document.getElementById('testForm').addEventListener('submit', function(e) {
    e.preventDefault();
    alert('üéâ –¢–ï–°–¢–û–í–ê–Ø –§–û–†–ú–ê –†–ê–ë–û–¢–ê–ï–¢!');
    console.log('‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —Ñ–æ—Ä–º–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞');
});

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ - –£–ü–†–û–©–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω');
    
    const form = document.getElementById('vacancyForm');
    const button = document.getElementById('submitBtn');
    
    if (!form) {
        console.error('‚ùå –§–æ—Ä–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        return;
    }
    
    if (!button) {
        console.error('‚ùå –ö–Ω–æ–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        return;
    }
    
    console.log('‚úÖ –§–æ—Ä–º–∞ –∏ –∫–Ω–æ–ø–∫–∞ –Ω–∞–π–¥–µ–Ω—ã');
    
    // –ü—Ä–æ—Å—Ç–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É
    button.addEventListener('click', function(e) {
        console.log('üéØ –ö–Ω–æ–ø–∫–∞ –Ω–∞–∂–∞—Ç–∞!');
        e.preventDefault();
        
        // –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
        if (!document.getElementById('agreement').checked) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–≥–ª–∞—Å–∏—Ç–µ—Å—å —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏');
            return;
        }
        
        // –ü—Ä–æ—Å—Ç–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
        alert('–§–û–†–ú–ê –û–¢–ü–†–ê–í–õ–Ø–ï–¢–°–Ø!');
        console.log('–§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è...');
        
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏
        const formData = new FormData(form);
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        
        fetch('/vacancy/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            alert('–£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
            form.reset();
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞:', error);
            alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
        });
    });
    
    // –¢–∞–∫–∂–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ —Å–∞–º—É —Ñ–æ—Ä–º—É
    form.addEventListener('submit', function(e) {
        console.log('üìù –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è (submit event)');
        e.preventDefault();
    });

    // –ú–∞—Å–∫–∞ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    const phoneInput = document.getElementById('id_phone');
    if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.startsWith('7') || value.startsWith('8')) {
                value = value.substring(1);
            }
            
            let formattedValue = '+7 (';
            if (value.length > 0) {
                formattedValue += value.substring(0, 3);
            }
            if (value.length > 3) {
                formattedValue += ') ' + value.substring(3, 6);
            }
            if (value.length > 6) {
                formattedValue += '-' + value.substring(6, 8);
            }
            if (value.length > 8) {
                formattedValue += '-' + value.substring(8, 10);
            }
            
            e.target.value = formattedValue;
        });
    }
});
</script>