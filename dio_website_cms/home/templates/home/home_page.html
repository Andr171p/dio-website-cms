{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block title %}{{ page.title }} | Мой сайт{% endblock %}

{% block extra_css %}
<style>
    /* Hero секция с космическим фоном */
    .hero-section {
        position: relative;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        background: linear-gradient(135deg, #000000, #0a0a2a 40%, #000000);
    }
    
    .hero-overlay {
        position: absolute;
        inset: 0;
        background: radial-gradient(ellipse at center, rgba(10, 10, 40, 0.4) 0%, rgba(0, 0, 0, 0.8) 70%);
        z-index: 2;
    }
    
    /* Космические элементы фона */
    .cosmic-background {
        position: absolute;
        inset: 0;
        overflow: hidden;
        pointer-events: none;
        z-index: 1;
    }
    
    #stars-canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    
    /* Параллакс слои */
    .parallax-layer {
        position: absolute;
        inset: 0;
        pointer-events: none;
    }
    
    .layer-1 {
        z-index: 3;
    }
    
    .layer-2 {
        z-index: 2;
    }
    
    .layer-3 {
        z-index: 1;
    }
    
    /* Контент героя */
    .hero-content {
        position: relative;
        z-index: 20;
        text-align: center;
        max-width: 1200px;
        padding: 2rem;
    }
    
    .hero-title {
        font-size: 3.5rem;
        font-weight: 900;
        margin-bottom: 1.5rem;
        background: linear-gradient(to right, #ffffff, #aaccff, #4d94ff);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        line-height: 1.2;
        text-shadow: 0 0 10px rgba(77, 148, 255, 0.5);
    }
    
    @media (min-width: 768px) {
        .hero-title {
            font-size: 5rem;
        }
    }
    
    .hero-subtitle {
        font-size: 1.25rem;
        color: #e2e8f0;
        margin-bottom: 2.5rem;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
        line-height: 1.6;
        text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
    }
    
    @media (min-width: 768px) {
        .hero-subtitle {
            font-size: 1.5rem;
        }
    }
    
    .accent-text {
        color: #4d94ff;
        text-shadow: 0 0 10px rgba(77, 148, 255, 0.7);
    }
    
    /* Кнопки */
    .hero-buttons {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        align-items: center;
        justify-content: center;
    }
    
    @media (min-width: 640px) {
        .hero-buttons {
            flex-direction: row;
        }
    }
    
    .btn-primary {
        display: inline-block;
        padding: 1rem 2rem;
        background: linear-gradient(to right, #4d78cc, #4d4dff);
        color: white;
        font-weight: 600;
        border-radius: 0.5rem;
        box-shadow: 0 4px 15px rgba(77, 148, 255, 0.4);
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }
    
    .btn-primary::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.2), transparent);
        transform: rotate(45deg);
        animation: shine 3s infinite;
    }
    
    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 0 30px rgba(77, 148, 255, 0.7);
    }
    
    .btn-secondary {
        display: inline-block;
        padding: 1rem 2rem;
        border: 2px solid #4d94ff;
        color: #4d94ff;
        font-weight: 600;
        border-radius: 0.5rem;
        background: transparent;
        transition: all 0.3s ease;
        cursor: pointer;
        text-shadow: 0 0 5px rgba(77, 148, 255, 0.3);
        box-shadow: 0 0 10px rgba(77, 148, 255, 0.3);
    }
    
    .btn-secondary:hover {
        background-color: rgba(77, 148, 255, 0.1);
        color: white;
        box-shadow: 0 0 20px rgba(77, 148, 255, 0.5);
    }
    
    @keyframes shine {
        0% { transform: translateX(-100%) rotate(45deg); }
        100% { transform: translateX(100%) rotate(45deg); }
    }
    
    /* Индикатор прокрутки */
    .scroll-indicator {
        position: absolute;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
        color: #4d94ff;
        cursor: pointer;
        z-index: 30;
    }
    
    .scroll-arrow {
        animation: bounce 2s infinite;
        filter: drop-shadow(0 0 5px rgba(77, 148, 255, 0.7));
    }
    
    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-10px);
        }
        60% {
            transform: translateY(-5px);
        }
    }
    
    /* Анимации появления */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(50px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    
    .animate-fade-in-up {
        animation: fadeInUp 1s ease-out forwards;
        opacity: 0;
    }
    
    .animate-fade-in {
        animation: fadeIn 1s ease-out forwards;
        animation-delay: 0.5s;
        opacity: 0;
    }
    
    .animate-fade-in-delayed {
        animation: fadeIn 1s ease-out forwards;
        animation-delay: 1s;
        opacity: 0;
    }
    
    /* Параллакс секции */
    .parallax-section {
        position: relative;
        overflow: hidden;
    }
    
    .parallax-element {
        position: absolute;
        will-change: transform;
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero секция -->
<section id="hero" class="hero-section parallax-section">
    <div class="hero-overlay"></div>
    
    <!-- Космический фон с Canvas -->
    <div class="cosmic-background">
        <canvas id="stars-canvas"></canvas>
        
        <!-- Слои для параллакса -->
        <div class="parallax-layer layer-1" id="parallax-layer-1"></div>
        <div class="parallax-layer layer-2" id="parallax-layer-2"></div>
        <div class="parallax-layer layer-3" id="parallax-layer-3"></div>
    </div>
    
    <div class="hero-content">
        <h1 class="hero-title animate-fade-in-up">
            РАСКРОЙТЕ
            <br>
            <span class="accent-text">КОСМИЧЕСКИЙ ПОТЕНЦИАЛ</span>
        </h1>
        
        <p class="hero-subtitle animate-fade-in">
            Откройте для себя решения следующего поколения, которые расширяют границы возможного.
            Где инновации встречаются с бесконечностью космоса.
        </p>
        
        <div class="hero-buttons animate-fade-in-delayed">
            <button class="btn-primary">
                Исследуйте вселенные
            </button>
            <button class="btn-secondary">
                Узнать больше
            </button>
        </div>
    </div>

    <!-- Индикатор прокрутки -->
    <div class="scroll-indicator" onclick="scrollToNextSection()">
        <div class="scroll-arrow">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="7 13 12 18 17 13"></polyline>
                <polyline points="7 6 12 11 17 6"></polyline>
            </svg>
        </div>
    </div>
</section>

<!-- Остальная часть контента -->
<!-- Включение секции новостей -->
<!-- Включение секции статистики -->
{% include "home/cases_section.html"  %}
{% include "home/news.html" %}

{% include "home/statistics_section.html" with statistic_pages=page.statistic_pages %}

{% include "certificates/certificates_page.html"  %}
{% endblock %}

{% block extra_js %}
<script>
// Создание космического фона с Canvas
function createCosmicBackground() {
    const canvas = document.getElementById('stars-canvas');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    let width = window.innerWidth;
    let height = window.innerHeight;
    
    // Установка размеров canvas
    canvas.width = width;
    canvas.height = height;
    
    // Создание звезд
    const stars = [];
    const shootingStars = [];
    const starCount = 400;
    
    // Инициализация обычных звезд
    for (let i = 0; i < starCount; i++) {
        stars.push({
            x: Math.random() * width,
            y: Math.random() * height,
            radius: Math.random() * 1.5,
            speed: Math.random() * 0.2,
            brightness: Math.random(),
            twinkleSpeed: Math.random() * 0.05,
            layer: Math.floor(Math.random() * 3) + 1 // Слой для параллакса
        });
    }
    
    // Инициализация падающих звезд
    createShootingStars(shootingStars, 5, width, height);
    
    // Анимация
    function animate() {
        requestAnimationFrame(animate);
        ctx.clearRect(0, 0, width, height);
        
        // Рисование звездного поля
        drawStars(ctx, stars, width, height);
        
        // Рисование падающих звезд
        drawShootingStars(ctx, shootingStars, width, height);
        
        // Рисование туманностей
        drawNebulae(ctx, width, height);
    }
    
    animate();
    
    // Обработка изменения размера окна
    window.addEventListener('resize', function() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
        
        // Обновление позиций звезд
        for (let i = 0; i < stars.length; i++) {
            stars[i].x = Math.random() * width;
            stars[i].y = Math.random() * height;
        }
        
        // Сброс падающих звезд
        shootingStars.length = 0;
        createShootingStars(shootingStars, 5, width, height);
    });
    
    // Создание параллакс элементов
    createParallaxElements();
}

// Создание падающих звезд
function createShootingStars(shootingStars, count, width, height) {
    for (let i = 0; i < count; i++) {
        shootingStars.push({
            active: false,
            x: 0,
            y: 0,
            speedX: 0,
            speedY: 0,
            life: 0,
            tailLength: 0,
            width: 0,
            delay: Math.random() * 200 // Задержка перед появлением
        });
    }
    
    // Запуск анимации падающих звезд
    animateShootingStars(shootingStars, width, height);
}

// Анимация падающих звезд
function animateShootingStars(shootingStars, width, height) {
    shootingStars.forEach((star, index) => {
        if (star.delay > 0) {
            star.delay--;
            return;
        }
        
        if (!star.active) {
            // Создание новой падающей звезды
            resetShootingStar(star, width, height);
            return;
        }
        
        // Обновление позиции
        star.x += star.speedX;
        star.y += star.speedY;
        star.life--;
        
        // Если звезда закончила жизнь или вышла за пределы экрана
        if (star.life <= 0 || star.x > width || star.y > height || star.x < 0 || star.y < 0) {
            star.active = false;
            star.delay = 50 + Math.random() * 150; // Случайная задержка перед следующим появлением
        }
    });
    
    // Продолжаем анимацию
    setTimeout(() => {
        requestAnimationFrame(() => animateShootingStars(shootingStars, width, height));
    }, 1000 / 30); // ~30 FPS
}

// Сброс падающей звезды
function resetShootingStar(star, width, height) {
    // Начальная позиция - случайная точка в верхней части экрана
    star.x = Math.random() * width;
    star.y = Math.random() * height * 0.2;
    
    // Случайное направление вниз с небольшим смещением вправо
    const angle = Math.PI / 2 + (Math.random() * 0.4 - 0.2); // Небольшой разброс углов
    const speed = 5 + Math.random() * 5;
    
    star.speedX = Math.cos(angle) * speed;
    star.speedY = Math.sin(angle) * speed;
    star.life = 50 + Math.random() * 50;
    star.tailLength = 30 + Math.random() * 40;
    star.width = 1 + Math.random() * 1.5;
    star.active = true;
}

// Рисование звезд
function drawStars(ctx, stars, width, height) {
    for (let i = 0; i < stars.length; i++) {
        const star = stars[i];
        
        // Мерцание звезд
        star.brightness += star.twinkleSpeed;
        if (star.brightness > 1) {
            star.brightness = 1;
            star.twinkleSpeed = -star.twinkleSpeed;
        } else if (star.brightness < 0.3) {
            star.brightness = 0.3;
            star.twinkleSpeed = -star.twinkleSpeed;
        }
        
        // Рисование звезды
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
        ctx.fill();
    }
}

// Рисование падающих звезд
function drawShootingStars(ctx, shootingStars, width, height) {
    for (let i = 0; i < shootingStars.length; i++) {
        const star = shootingStars[i];
        
        if (!star.active) continue;
        
        // Рисование хвоста
        const gradient = ctx.createLinearGradient(
            star.x, star.y, 
            star.x - star.speedX * 3, star.y - star.speedY * 3
        );
        gradient.addColorStop(0, 'rgba(255, 255, 255, 0.8)');
        gradient.addColorStop(0.5, 'rgba(200, 220, 255, 0.5)');
        gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
        
        ctx.beginPath();
        ctx.moveTo(star.x, star.y);
        ctx.lineTo(star.x - star.speedX * 3, star.y - star.speedY * 3);
        ctx.strokeStyle = gradient;
        ctx.lineWidth = star.width;
        ctx.stroke();
        
        // Рисование головы звезды
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.width * 0.7, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
        ctx.fill();
    }
}

// Рисование туманностей
function drawNebulae(ctx, width, height) {
    // Рисование нескольких цветных туманностей
    const nebulae = [
        { x: width * 0.2, y: height * 0.3, radius: width * 0.4, color: 'rgba(65, 90, 220, 0.03)' },
        { x: width * 0.7, y: height * 0.6, radius: width * 0.3, color: 'rgba(180, 65, 220, 0.03)' },
        { x: width * 0.4, y: height * 0.7, radius: width * 0.5, color: 'rgba(65, 220, 150, 0.02)' }
    ];
    
    for (const nebula of nebulae) {
        const gradient = ctx.createRadialGradient(
            nebula.x, nebula.y, 0,
            nebula.x, nebula.y, nebula.radius
        );
        gradient.addColorStop(0, nebula.color);
        gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');
        
        ctx.beginPath();
        ctx.arc(nebula.x, nebula.y, nebula.radius, 0, Math.PI * 2);
        ctx.fillStyle = gradient;
        ctx.fill();
    }
}

// Создание элементов для параллакса
function createParallaxElements() {
    const layer1 = document.getElementById('parallax-layer-1');
    const layer2 = document.getElementById('parallax-layer-2');
    const layer3 = document.getElementById('parallax-layer-3');
    
    if (!layer1 || !layer2 || !layer3) return;
    
    // Создаем далекие звезды для слоя 3 (самый медленный параллакс)
    for (let i = 0; i < 20; i++) {
        const star = document.createElement('div');
        star.className = 'parallax-element';
        star.style.width = '2px';
        star.style.height = '2px';
        star.style.borderRadius = '50%';
        star.style.backgroundColor = 'rgba(255, 255, 255, 0.4)';
        star.style.boxShadow = '0 0 4px rgba(255, 255, 255, 0.5)';
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        layer3.appendChild(star);
    }
    
    // Создаем средние звезды для слоя 2
    for (let i = 0; i < 15; i++) {
        const star = document.createElement('div');
        star.className = 'parallax-element';
        star.style.width = '3px';
        star.style.height = '3px';
        star.style.borderRadius = '50%';
        star.style.backgroundColor = 'rgba(255, 255, 255, 0.6)';
        star.style.boxShadow = '0 0 6px rgba(255, 255, 255, 0.7)';
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        layer2.appendChild(star);
    }
    
    // Создаем ближние звезды для слоя 1 (самый быстрый параллакс)
    for (let i = 0; i < 10; i++) {
        const star = document.createElement('div');
        star.className = 'parallax-element';
        star.style.width = '4px';
        star.style.height = '4px';
        star.style.borderRadius = '50%';
        star.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
        star.style.boxShadow = '0 0 8px white';
        star.style.left = `${Math.random() * 100}%`;
        star.style.top = `${Math.random() * 100}%`;
        layer1.appendChild(star);
    }
}

// Эффект параллакса при прокрутке
function initParallax() {
    const heroSection = document.querySelector('.hero-section');
    if (!heroSection) return;
    
    window.addEventListener('scroll', function() {
        const scrollPosition = window.pageYOffset;
        const layers = [
            document.getElementById('parallax-layer-1'),
            document.getElementById('parallax-layer-2'),
            document.getElementById('parallax-layer-3')
        ];
        
        // Коэффициенты параллакса для каждого слоя
        const coefficients = [0.4, 0.2, 0.1];
        
        layers.forEach((layer, index) => {
            if (layer) {
                const move = scrollPosition * coefficients[index];
                layer.style.transform = `translateY(${move}px)`;
            }
        });
    });
}

// Прокрутка к следующей секции
function scrollToNextSection() {
    const nextSection = document.querySelector('.cases-section, .news-section, .statistics-section');
    if (nextSection) {
        nextSection.scrollIntoView({ behavior: 'smooth' });
    }
}

// Инициализация при загрузке документа
document.addEventListener('DOMContentLoaded', function() {
    createCosmicBackground();
    initParallax();
    
    // Ваш существующий код для карусели
    const slides = document.querySelectorAll('.hero-slide');
    const dots = document.querySelectorAll('.carousel-dot');
    const navBlocks = document.querySelectorAll('.nav-block');

    if (slides.length > 0) {
        let currentSlide = 0;
        let autoSlideInterval;

        function showSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.remove('active');
            });
            dots.forEach((dot, i) => {
                dot.classList.remove('active');
            });
            navBlocks.forEach((block, i) => {
                block.classList.remove('active');
            });

            if (slides[index]) {
                slides[index].classList.add('active');
                if (dots[index]) {
                    dots[index].classList.add('active');
                }
                if (navBlocks[index]) {
                    navBlocks[index].classList.add('active');
                }
                currentSlide = index;
            }
        }

        function startAutoSlide() {
            if (slides.length <= 1) return;
            stopAutoSlide();
            autoSlideInterval = setInterval(() => {
                let nextSlide = (currentSlide + 1) % slides.length;
                showSlide(nextSlide);
            }, 5000);
        }

        function stopAutoSlide() {
            if (autoSlideInterval) {
                clearInterval(autoSlideInterval);
            }
        }

        showSlide(currentSlide);

        dots.forEach((dot, index) => {
            dot.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                stopAutoSlide();
                showSlide(index);
                startAutoSlide();
            });
        });

        navBlocks.forEach((block, index) => {
            block.addEventListener('click', (e) => {
                e.preventDefault();
                stopAutoSlide();
                showSlide(index);
                startAutoSlide();
            });
        });

        if (slides.length > 1) {
            startAutoSlide();
            const heroSection = document.querySelector('.hero');
            if (heroSection) {
                heroSection.addEventListener('mouseenter', () => {
                    stopAutoSlide();
                });
                heroSection.addEventListener('mouseleave', () => {
                    startAutoSlide();
                });
            }
        }
    }
});
</script>
{% endblock %}