{% load wagtailcore_tags wagtailimages_tags static %}

<section id="cases" class="py-20 bg-gradient-to-br from-gray-50 to-white">
    <div class="container mx-auto px-6">
        <!-- Header -->
         <h1>DHDHHDSJDJAS</h1>
        <div class="text-center mb-16">
            <h2 class="text-4xl lg:text-5xl font-bold text-gray-900 mb-6">
                {{ value.section_title }}
            </h2>
            {% if value.section_description %}
            <p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
                {{ value.section_description }}
            </p>
            {% endif %}
        </div>

        <!-- Filters -->
        {% if value.show_filters and all_industries %}
        <div class="flex flex-wrap justify-center gap-4 mb-12">
            <button class="px-6 py-3 rounded-full font-medium bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg">
                Все проекты
            </button>
            {% for industry in all_industries %}
            <button class="px-6 py-3 rounded-full font-medium bg-white text-gray-600 hover:text-blue-600 shadow-md hover:shadow-lg">
                {{ industry }}
            </button>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Cases Grid -->
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for case_page in value.cases %}
                {% with case=case_page.specific %}
                <div class="bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 group">
                    <!-- Image -->
                    {% if case.customer_logo %}
                    <div class="relative overflow-hidden h-48 bg-gray-100 flex items-center justify-center p-8">
                        {% image case.customer_logo width-200 class="h-24 object-contain group-hover:scale-110 transition-transform duration-500" %}
                    </div>
                    {% else %}
                    <div class="relative overflow-hidden h-48 bg-gradient-to-r from-blue-500 to-blue-600 flex items-center justify-center">
                        <span class="text-white text-4xl font-bold">{{ case.customer_name|slice:":2"|upper }}</span>
                    </div>
                    {% endif %}

                    <!-- Content -->
                    <div class="p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors duration-200">
                            {{ case.title }}
                        </h3>
                        
                        {% if case.customer_name %}
                        <p class="text-blue-600 font-medium text-sm mb-3">
                            {{ case.customer_name }}
                        </p>
                        {% endif %}

                        {% if case.industry %}
                        <span class="inline-block bg-blue-100 text-blue-800 text-xs px-3 py-1 rounded-full mb-3">
                            {{ case.industry }}
                        </span>
                        {% endif %}

                        <p class="text-gray-600 text-sm leading-relaxed mb-4">
                            {{ case.intro|striptags|truncatewords:20 }}
                        </p>

                        <!-- Technologies Preview -->
                        {% if case.content %}
                        <div class="flex flex-wrap gap-2 mb-4">
                            {% for block in case.content %}
                                {% if forloop.counter <= 3 %}
                                    {% if block.block_type == "automation_fields" %}
                                        {% for field in block.value.fields_list|slice:":2" %}
                                        <span class="bg-blue-50 text-blue-600 text-xs px-2 py-1 rounded-full">
                                            {{ field }}
                                        </span>
                                        {% endfor %}
                                    {% elif block.block_type == "technologies" %}
                                        {% for tech in block.value.technologies_list|slice:":2" %}
                                        <span class="bg-blue-50 text-blue-600 text-xs px-2 py-1 rounded-full">
                                            {{ tech }}
                                        </span>
                                        {% endfor %}
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- Results Preview -->
                        {% if case.content %}
                        <div class="space-y-2 mb-4">
                            {% for block in case.content %}
                                {% if block.block_type == "metrics" and forloop.first %}
                                    {% for metric in block.value.metrics_list|slice:":2" %}
                                    <div class="flex items-start text-sm text-gray-600">
                                        <div class="w-1.5 h-1.5 bg-green-500 rounded-full mt-2 mr-3 flex-shrink-0"></div>
                                        {{ metric.value.description }}: {{ metric.value.value }}%
                                    </div>
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- CTA -->
                        <a href="{{ case.url }}" class="flex items-center text-blue-600 hover:text-blue-700 font-semibold text-sm group-hover:translate-x-2 transition-all duration-200">
                            <span>Подробнее о проекте</span>
                            <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </a>
                    </div>
                </div>
                {% endwith %}
            {% endfor %}
        </div>

        <!-- Load More -->
        {% if value.show_view_all_button %}
        <div class="text-center mt-12">
            {% with cases_index=page.get_cases_index %}
                {% if cases_index %}
                <a href="{{ cases_index.url }}" class="bg-white border-2 border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white px-8 py-3 rounded-lg font-semibold transition-all duration-200">
                    Показать больше проектов
                </a>
                {% endif %}
            {% endwith %}
        </div>
        {% endif %}
    </div>
</section>

<style>
    .group:hover {
        transform: translateY(-5px);
    }
    
    .transition-all {
        transition: all 0.3s ease;
    }
    
    .bg-gradient-to-br {
        background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Простая реализация фильтрации
    const filterButtons = document.querySelectorAll('#cases button');
    const caseCards = document.querySelectorAll('#cases .bg-white.rounded-2xl');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            const filter = this.textContent.trim();
            
            // Убираем активный класс у всех кнопок
            filterButtons.forEach(btn => {
                btn.classList.remove('bg-gradient-to-r', 'from-blue-600', 'to-blue-700', 'text-white');
                btn.classList.add('bg-white', 'text-gray-600');
            });
            
            // Добавляем активный класс текущей кнопке
            this.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-blue-700', 'text-white');
            this.classList.remove('bg-white', 'text-gray-600');
            
            // Фильтрация карточек
            caseCards.forEach(card => {
                const industry = card.querySelector('.bg-blue-100')?.textContent.trim();
                
                if (filter === 'Все проекты' || industry === filter) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    });
});
</script>