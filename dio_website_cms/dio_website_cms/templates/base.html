{% load static wagtailcore_tags wagtailuserbar wagtailimages_tags wagtailsettings_tags django_htmx %}

<!DOCTYPE html>
<html page="0" lang="ru"  class="w-mod-js w-mod-ix wf-manrope-n4-active wf-montserrat-i6-active wf-montserrat-i4-active wf-montserrat-i3-active wf-montserrat-i5-active wf-montserrat-i7-active wf-montserrat-i1-active wf-montserrat-i9-active wf-montserrat-i2-active wf-montserrat-i8-active wf-montserrat-n1-active wf-montserrat-n7-active wf-montserrat-n2-active wf-montserrat-n6-active wf-montserrat-n3-active wf-montserrat-n4-active wf-montserrat-n5-active wf-montserrat-n8-active wf-montserrat-n9-active wf-active">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ page.title }}{% endblock %}</title>

    <!-- Favicon -->
    {% get_settings use_default_site=True as settings %}
    {% if settings.base.SiteSettings.icon %}
        {% image settings.base.SiteSettings.icon width-320 height-320 as favicon %}
        <link rel="icon" href="{{ favicon.url }}" type="image/{{ favicon.format }}">
    {% else %}
        <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'></svg>">
    {% endif %}


    <!-- CSS -->
    <link id="theme-style" href="{% static 'css/theme-dark.css' %}?v=1.0" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">

    <!-- Preconnect -->
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
    <script>
        WebFont.load({
            google: { families: ["Manrope:400,500,600,700", "Comfortaa:400"] }
        });
    </script>
    <script type="text/javascript">
            WebFont.load({
                google: {
                    families: ["Manrope:regular", "Manrope:regular", "Manrope:regular"]
                }
            });
        </script>

<link href="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.css" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>

    <!-- Tailwind (оставлено, если используется) -->
    <script src="https://cdn.tailwindcss.com/3.4.17"></script>

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

                {% if request.META.HTTP_HOST != 'localhost' and request.META.HTTP_HOST != '127.0.0.1' %}
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
{% endif %}

    <script>
document.addEventListener('DOMContentLoaded', () => {
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        const form = document.querySelector('form[data-turnstile-sitekey]');
        if (form) {
            form.removeAttribute('data-turnstile-sitekey');
            // Удаляем классы, если они мешают
            form.classList.remove('cf-turnstile');
        }
    }
});
</script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('a[href^="?"]').forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const url = link.href;
        document.querySelector('#cases-section').style.opacity = '0.5';
        setTimeout(() => { window.location = url; }, 150);
      });
    });
  });
</script>

</head>

<body class="min-h-screen bg-white dark:bg-gray-900 transition-colors duration-300">
    {% wagtailuserbar %}

    {% include "base/header.html" %}
    <main>{% block content %}{% endblock %}</main>
    {% include "base/contact.html" %}
    {% include "base/footer.html" %}
    {% include "base/chat.html" %}

    <!-- Кнопка переключения темы -->
    <button id="theme-toggle" class="fixed top-20 right-4 z-[1001] p-2.5 rounded-full shadow-lg transition-all duration-300 hover:scale-110">
        <svg id="light-icon" class="w-5 h-5" viewBox="0 0 128 128" fill="currentColor">
            <path d="M37.41 41.95c-9.71 12.48-9.54 34.65 2.87 45.64c14.09 12.47 33.92 12.34 46.39.87c14.95-13.76 14.09-36.66.87-49.63c-13.29-13.04-37.04-13.72-50.13 3.12z"/>
            <path d="M53 37.67c-3.84-1.7-8.04 2.93-9.87 6.09c-1.83 3.17-3.53 9.38.37 10.97c3.9 1.58 6.7-1.1 9.51-5.73c2.79-4.63 4.38-9.38-.01-11.33z"/>
            <path d="M63 20.27c-.93 1.74-.62 3.08 1.23 3.52c1.85.44 13.36 2.31 14.33 2.37c1.41.09 1.93-.97 1.76-2.2c-.18-1.23-2.99-18.46-3.25-20.04S75.14.76 73.55 2.87S63.7 18.96 63 20.27z"/>
            <path d="M92.8 32.23c-1.81.56-1.76 1.67-.79 3.08c.97 1.41 7.65 11.6 8.26 12.31c.62.7 1.67.88 2.55-.18c.88-1.05 11.86-16.45 12.66-17.41c1.32-1.58.53-3.25-1.49-2.73c-1.54.41-20.05 4.58-21.19 4.93z"/>
            <path d="M106.6 61.86c-1.3-.74-2.99-.53-3.43 1.14c-.44 1.67-2.37 13.8-2.55 14.86s.62 2.11 1.93 1.85s19.45-2.95 20.66-3.25c2.11-.53 2.81-2.64.62-4.22c-1.42-1.03-16-9.68-17.23-10.38z"/>
            <path d="M92.09 90.6c1.4-.75 2.64-.18 2.99 1.41c.35 1.58 4.22 17.76 4.84 20.75c.31 1.5-1.41 2.73-2.81 1.85c-1.41-.88-16.69-11.53-17.67-12.4c-1.41-1.23-.43-2.51.26-3.16c1.4-1.33 11.07-7.74 12.39-8.45z"/>
            <path d="M49.54 99.48c-1.77-.17-2.29 1.41-2.02 2.81c.26 1.41 2.9 19.24 3.08 20.57c.26 1.93 2.29 2.73 3.6.79s10.35-16.4 11.08-17.76c1.32-2.46.35-2.99-.97-3.6c-1.31-.61-12.92-2.63-14.77-2.81z"/>
            <path d="M24.23 79c1.23-2.02 2.81-1.49 3.96.44c.78 1.32 7.38 10.2 8 11.16c.62.97.88 2.81-1.05 3.25c-1.95.45-17.68 4.58-20.14 5.02c-2.46.44-3.87-1.49-2.29-3.6c.92-1.24 10.82-15.12 11.52-16.27z"/>
            <path d="M20.89 63.7c2.25 1 3.31.64 3.78-.97c.62-2.11 2.46-11.78 2.55-13.98c.06-1.43-.53-2.81-2.73-2.46S6.47 48.85 4.45 49.55c-2.35.82-2.18 3.4-.62 4.22c1.85.97 15.47 9.23 17.06 9.93z"/>
            <path d="M48.23 26.78c1.27-1.01.88-2.46-.26-3.25c-1.14-.79-15.26-11-17.05-12.4c-1.58-1.23-3.52-.79-2.99 2.02c.38 2.02 4.88 19.7 5.19 20.92c.35 1.41 1.41 2.11 2.64 1.23c1.21-.87 11.15-7.46 12.47-8.52z"/>
        </svg>
        <svg id="dark-icon" class="w-5 h-5 hidden" viewBox="0 0 48 48" fill="currentColor">
            <path d="M28.0527 4.41085C22.5828 5.83695 18.5455 10.8106 18.5455 16.7273C18.5455 23.7564 24.2436 29.4545 31.2727 29.4545C37.1894 29.4545 42.1631 25.4172 43.5891 19.9473C43.8585 21.256 44 22.6115 44 24C44 35.0457 35.0457 44 24 44C12.9543 44 4 35.0457 4 24C4 12.9543 12.9543 4 24 4C25.3885 4 26.744 4.14149 28.0527 4.41085Z"/>
        </svg>
    </button>

    <!-- Снежинки (только для темы new_year) -->
    {% if settings.base.ThemeSettings.theme == 'new_year' %}
    <div id="snowflakeContainer" class="fixed inset-0 pointer-events-none z-[9999] overflow-hidden">
        <span class="snowflake"></span>
    </div>

    <script>
        (function() {
            const container = document.getElementById('snowflakeContainer');
            if (!container) return;

            let snowflakes = [], width, height, reset = false;
            const count = 60;

            class Flake {
                constructor(el, speed, x, y) {
                    this.el = el; this.speed = speed; this.x = x; this.y = y;
                    this.scale = 1; this.angle = 0; this.dir = Math.random() < 0.5 ? 1 : -1;
                    el.style.opacity = 0.1 + Math.random() * 0.3;
                }
                update(dt) {
                    this.angle += this.speed / 5000 * dt;
                    this.x += this.dir * dt * this.speed * Math.cos(this.angle) / 40;
                    this.y += Math.sin(this.angle) / 40 + this.speed * dt / 30;
                    this.scale = 0.5 + Math.abs(10 * Math.cos(this.angle)) / 20;
                    this.el.style.transform = `translate3d(${this.x}px, ${this.y}px, 0) scale(${this.scale})`;
                    if (this.y > height) this.y = -50;
                }
            }

            function init() {
                width = document.documentElement.clientWidth;
                height = document.documentElement.clientHeight;
                container.style.display = 'block';

                const template = container.querySelector('.snowflake');
                for (let i = 0; i < count; i++) {
                    const clone = template.cloneNode(true);
                    container.appendChild(clone);
                    snowflakes.push(new Flake(clone, 5 + Math.random() * 40, rand(width), rand(height)));
                }
                container.removeChild(template);
                requestAnimationFrame(tick);
            }

            let last = performance.now();
            function tick(now) {
                const dt = Math.min(now - last, 100) / (1000 / 60);
                last = now;
                snowflakes.forEach(f => f.update(dt));
                if (reset) { width = innerWidth; height = innerHeight; reset = false; }
                requestAnimationFrame(tick);
            }

            const rand = (max) => Math.random() * (max + 100) - 50;
            window.addEventListener('resize', () => reset = true);
            window.addEventListener('DOMContentLoaded', init);
        })();
    </script>

    <style>
        .snowflake {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            width: 13px;
            height: 13px;
            pointer-events: none;
            user-select: none;
        }
    </style>
    {% endif %}

    <!-- Основные скрипты -->
    <script defer src="{% static 'js/main.js' %}"></script>
    <script defer src="{% static 'js/chunk_1.js' %}"></script>
    <script defer src="{% static 'js/chunk_2.js' %}"></script>
    <script defer src="{% static 'js/chunk_3.js' %}"></script>

   

    <!-- Переключение темы -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const toggle = document.getElementById('theme-toggle');
            const style = document.getElementById('theme-style');
            const light = document.getElementById('light-icon');
            const dark = document.getElementById('dark-icon');
            let theme = localStorage.getItem('theme') || 'light';

            const apply = (t) => {
                theme = t;
                localStorage.setItem('theme', t);
                style.href = t === 'dark' ? "{% static 'css/theme-light.css' %}?v=1.0" : "{% static 'css/theme-dark.css' %}?v=1.0";
                document.body.classList.toggle('theme-dark', t === 'dark');
                document.body.classList.toggle('theme-light', t === 'light');
                light.classList.toggle('hidden', t === 'dark');
                dark.classList.toggle('hidden', t === 'light');
                toggle.classList.toggle('bg-gray-200', t === 'dark');
                toggle.classList.toggle('bg-gray-800', t === 'light');
                toggle.classList.toggle('text-black', t === 'dark');
                toggle.classList.toggle('text-white', t === 'light');
            };

            apply(theme);
            toggle.addEventListener('click', () => apply(theme === 'light' ? 'dark' : 'light'));
        });
    </script>

    <!-- Дополнительные стили -->
    <style>
        .hidden { display: none !important; }
        #theme-toggle { transition: all 0.3s ease; }
        #theme-toggle:hover { opacity: 0.9; }
        .theme-dark #theme-toggle { @apply bg-gray-200 text-black; }
        .theme-light #theme-toggle { @apply bg-gray-800 text-white; }
        .theme-new-year { background: linear-gradient(to bottom, #e0f7fa, #b0e0e6); }
        .theme-autumn { background: linear-gradient(to bottom, #f5e8c7, #8b4513); }
    </style>
</body>
</html>