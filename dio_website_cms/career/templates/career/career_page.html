{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block content %}
<article class="min-h-screen bg-gradient-to-b from-black to-[#0a0a0a] text-white">

  {% for block in page.content %}

    {% if block.block_type == "hero" %}
      <section class="section is-secondary relative min-h-[700px] flex items-center overflow-hidden">
        {% if block.value.image %}
          {% image block.value.image original as bg_image %}
          <div class="absolute inset-0 z-0">
            <img src="{{ bg_image.url }}" alt="{{ block.value.title }}" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-black/30"></div>
          </div>
        {% endif %}

        <div class="container mx-auto relative z-10">
          <div class="grid grid-cols-1 lg:grid-cols-1 gap-8 lg:gap-12 items-center">
            <div class="space-y-6">
              <h1 class="heading_h3 pb-10 text-white drop-shadow-md gs-reveal">
                {{ block.value.title }}
              </h1>
              {% if block.value.subtitle %}
                <p class="heading_h2 py-10 text-white/90 gs-reveal">
                  {{ block.value.subtitle|striptags }}
                </p>
              {% endif %}
              {% if block.value.cta_text %}
                <a href="{% if block.value.cta_scroll %}#vacancies{% else %}{{ page.url }}{% endif %}"
                   {% if block.value.cta_scroll %}onclick="document.getElementById('vacancies')?.scrollIntoView({ behavior: 'smooth' });"{% endif %}
                   class="button is-secondary w-button inline-block px-6 py-3 rounded-lg shadow-lg gs-reveal"
                   style="color:white; box-shadow: 0 0 0 2px white inset;">
                  {{ block.value.cta_text }}
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      </section>

    {% elif block.block_type == 'text_section' %}
      <section class="py-24 bg-[#111]">
        <div class="container mx-auto px-6 ">
          <h2 class="heading_h3 md:text-5xl font-bold  mb-8">{{ block.value.title }}</h2>
          {% if block.value.content %}
            <div class="prose prose-invert max-w-none text-gray-300">
              {{ block.value.content|richtext }}
            </div>
          {% endif %}
          {% if block.value.image %}
            {% image block.value.image original as img %}
            <img src="{{ img.url }}" alt="" class="w-full rounded-2xl mt-12 shadow-2xl">
          {% endif %}
        </div>
      </section>

    {% elif block.block_type == 'values' %}
      <section class="py-24 bg-[#111]">
        <div class="container mx-auto px-6">
          <h2 class="heading_h3 md:text-5xl font-bold  mb-16">{{ block.value.title }}</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for item in block.value.items %}
              <div class="bg-[#1a1a1a] p-8 rounded-2xl border border-red-900/20 hover:border-red-800/50 transition-all group">
                {% if item.icon %}
                  {% image item.icon width-64 as icon %}
                  <img src="{{ icon.url }}" alt="" class="w-16 h-16 mb-6 opacity-80 group-hover:opacity-100 transition">
                {% endif %}
                <h3 class="text-2xl font-bold mb-3">{{ item.title }}</h3>
                <p class="text-gray-400">{{ item.description }}</p>
              </div>
            {% endfor %}
          </div>
        </div>
      </section>

    {% elif block.block_type == 'vacancies_list' %}
      <section id="vacancies" class="py-24">
        <div class="container mx-auto px-6">
          <h2 class="heading_h3 md:text-5xl font-bold  mb-16">{{ block.value.title }}</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for vacancy in page.get_children.live %}
              <a href="{{ vacancy.url }}" class="block group">
                <div class="bg-[#1a1a1a] p-8 rounded-2xl border border-red-900/20 hover:border-red-600 transition-all h-full flex flex-col">
                  <div class="flex justify-between items-start mb-4">
                    <h3 class="text-2xl font-bold group-hover:text-red-400 transition">{{ vacancy.title }}</h3>
                    {% if vacancy.specific.badge %}
                      <span class="px-3 py-1 bg-red-600/20 text-red-400 text-xs rounded-full">
                        {% if vacancy.specific.badge == 'hot' %}Горячая{% endif %}
                        {% if vacancy.specific.badge == 'new' %}Новая{% endif %}
                        {% if vacancy.specific.badge == 'remote' %}Удалённо{% endif %}
                      </span>
                    {% endif %}
                  </div>
                  <div class="text-sm text-gray-400 space-y-1 mb-6">
                    <p><strong class="text-red-400">{{ vacancy.specific.department }}</strong></p>
                    {% if vacancy.specific.salary %}<p>Зарплата: <strong class="text-red-400">{{ vacancy.specific.salary }}</strong></p>{% endif %}
                    <p>Локация: {{ vacancy.specific.location }}</p>
                    <p>Формат: 
                      {% if vacancy.specific.work_format == 'office' %}Офис
                      {% elif vacancy.specific.work_format == 'remote' %}Удалённо
                      {% else %}Гибрид{% endif %}
                    </p>
                  </div>
                  <div class="mt-auto flex items-center text-red-400 font-semibold">
                    Подробнее
                    <svg class="w-5 h-5 ml-2 group-hover:translate-x-1 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                  </div>
                </div>
              </a>
            {% empty %}
              <p class="col-span-full  text-xl text-gray-500">Вакансий пока нет</p>
            {% endfor %}
          </div>
        </div>
      </section>

    {% elif block.block_type == 'form' %}
      <section id="apply" class="py-24 bg-[#111]">
        <div class="container mx-auto px-6 ">
          <div class=" mb-12">
            <h2 class="heading_h3 md:text-5xl font-bold mb-4">{{ block.value.title }}</h2>
            {% if block.value.description %}
              <p class="text-xl text-gray-400">{{ block.value.description }}</p>
            {% endif %}
          </div>
          <div class="bg-[#1a1a1a] rounded-3xl p-8 lg:p-12 border border-red-900/30">
            {% include "vacancy/includes/vacancy_form.html" %}
          </div>
        </div>
      </section>

    {% elif block.block_type == 'office' %}
      <section class="py-24">
        <div class="container mx-auto px-6">
          <h2 class="heading_h3 md:text-5xl font-bold  mb-16">{{ block.value.title }}</h2>
          <div class="rounded-3xl overflow-hidden shadow-2xl border border-red-900/20">
            <iframe 
              src="https://yandex.ru/map-widget/v1/org/dio_konsalt/41393573854/?ll=65.548711%2C57.139781&z=16"
              width="100%" height="500" frameborder="0" allowfullscreen="true">
            </iframe>
          </div>
          {% if block.value.address %}
            <p class=" text-gray-400 mt-8 text-lg">{{ block.value.address }}</p>
          {% endif %}
        </div>
      </section>

    {% endif %}

  {% endfor %}

</article>

<style>
  @keyframes fade-up {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fade-up {
    animation: fade-up 0.8s ease-out forwards;
  }
  .animation-delay-200 { animation-delay: 0.2s; opacity: 0; }
  .animation-delay-400 { animation-delay: 0.4s; opacity: 0; }
  
  /* Адаптивная сетка */
  @media (min-width: 768px) {
    .grid-cols-1 { grid-template-columns: 1fr; }
    .md\:grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
    .lg\:grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
  }
</style>
{% endblock %}