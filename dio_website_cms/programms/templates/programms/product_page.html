{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags wagtailembeds_tags static humanize %}
{% block content %}

    

    <article class="w-full">

    <!-- Hero секция -->
    <section class="section is-secondary pt-5 relative min-h-[700px] flex items-center overflow-hidden">
        {% if page.hero_image %}
            {% image page.hero_image fill-1920x1080 original as bg_image %}
            <div class="absolute inset-0 z-0 ">
                <img src="{{ bg_image.url }}" alt="{{ page.title }}" class="bg-black/50 w-full h-full object-cover">
                <div class="absolute inset-0"></div>
            </div>
        {% endif %}
        <div class="container mx-auto px-4 lg:px-8 relative z-10">
            <div class="grid grid-cols-1 lg:grid-cols-1 gap-8 lg:gap-12 items-center">
                <div class="space-y-6">
                    <h1 class="heading_h3 text-white drop-shadow-md gs-reveal">{{ page.title }}</h1>
                    {% if page.description %}
                        <div class="text-white rich-content drop-shadow-md gs-reveal rich-text w-richtext heading_h4">
                            {{ page.description|richtext }}
                        </div>
                    {% endif %}
                    <div class="space-y-4 gs-reveal">
                        {% if page.price %}
                            <p class="paragraph_large text-white">Цена: {{ page.price|intcomma }} руб.</p>
                        {% endif %}
                        {% if page.buy_link %}
                            <a href="{{ page.buy_link }}" class="button w-button inline-block px-6 py-3 rounded-lg">
                                Связаться с нами
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Контентные секции -->
    {% for section in page.content %}
        <section class="section">
            <div class="container mx-auto heading_h5">

                <!-- Заголовок секции -->
                <h2 class="heading_h2 mb-8">{{ section.value.heading }}</h2>

                <!-- Вложенные блоки секции -->
                {% for block in section.value.content %}

                    {% if block.block_type == 'paragraph' %}
                        <div class="heading_h5 rich-content">{{ block.value|richtext }}</div>

                    {% elif block.block_type == 'image' %}
                        <div class="w-layout-grid grid_2-col tablet-1-col gap-xxlarge items-center">
                            {% if block.value.image_position == 'left' %}
                                <div class="image-ratio_auto">
                                    {% image block.value.image fill-400x300 class="image_cover gs-reveal" %}
                                </div>
                                <div class="header max-width_large space-y-6">
                                    <h2 class="heading_h2 gs-reveal">{{ block.value.text_content.heading }}</h2>
                                    {% if block.value.text_content.description %}
                                        <div class="heading_h4 rich-text w-richtext">
                                            {{ block.value.text_content.description|richtext }}
                                        </div>
                                    {% endif %} 
                                    {% if block.value.text_content.button_text and block.value.text_content.button_url %}
                                        <a href="{{ block.value.text_content.button_url }}" class="button is-secondary w-button gs-reveal">
                                            {{ block.value.text_content.button_text }}
                                        </a>
                                    {% endif %}
                                </div>
                            {% else %}
                                <div class="header max-width_large space-y-6">
                                    <h2 class="heading_h2 gs-reveal">{{ block.value.text_content.heading }}</h2>
                                    {% if block.value.text_content.description %}
                                        <div class="heading_h4 rich-text w-richtext">
                                            {{ block.value.text_content.description|richtext }}
                                        </div>
                                    {% endif %}
                                    {% if block.value.text_content.button_text and block.value.text_content.button_url %}
                                        <a href="{{ block.value.text_content.button_url }}" class="button is-secondary w-button gs-reveal">
                                            {{ block.value.text_content.button_text }}
                                        </a>
                                    {% endif %}
                                </div>
                                <div class="image-ratio_auto">
                                    {% image block.value.image fill-400x300 class="image_cover gs-reveal" %}
                                </div>
                            {% endif %}
                        </div>

                    {% elif block.block_type == 'image_carousel' %}
                        <div class="carousel relative gs-reveal">
                            {% for item in block.value %}
                                <div class="carousel-item {% if not forloop.first %}hidden{% endif %}">
                                    {% image item.image fill-800x600 class="image_cover image-ratio_auto" %}
                                    {% if item.caption %}
                                        <p class="text-center text-color_secondary mt-2">{{ item.caption }}</p>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>

                    {% elif block.block_type == 'image_grid' %}
                        <div class="w-layout-grid grid_3-col gap-xsmall gs-reveal">
                            {% for item in block.value %}
                                <div class="image-ratio_auto">
                                    {% image item.image fill-400x300 class="image_cover" %}
                                    {% if item.caption %}
                                        <p class="text-center text-color_secondary mt-2">{{ item.caption }}</p>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>

                    {% elif block.block_type == 'table' %}
                        <div class="card on-secondary gs-reveal">
                            <div class="card_body padding-left_medium padding-top_xxsmall">
                                <div class="w-richtext">
                                    <table class="w-full">
                                        {% if block.value.first_row_is_table_header %}
                                            <thead>
                                                <tr>
                                                    {% for cell in block.value.data|first %}
                                                        <th class="padding-left_medium divider-vertical padding-top_xxsmall">
                                                            {{ cell }}
                                                        </th>
                                                    {% endfor %}
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for cells in block.value.data|slice:"1:" %}
                                                    <tr>
                                                        {% for cell in cells %}
                                                            <td class="padding-left_medium divider-vertical padding-top_xxsmall text-color_secondary">
                                                                {{ cell }}
                                                            </td>
                                                        {% endfor %}
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        {% else %}
                                            <tbody>
                                                {% for cells in block.value.data %}
                                                    <tr>
                                                        {% for cell in cells %}
                                                            <td class="padding-left_medium divider-vertical padding-top_xxsmall text-color_secondary">
                                                                {{ cell }}
                                                            </td>
                                                        {% endfor %}
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        {% endif %}
                                    </table>
                                </div>
                            </div>
                        </div>

                    {% elif block.block_type == 'numbered_list' %}
                        <ol class="rich-text w-richtext max-width_large gs-reveal">
                            {% for item in block.value.items %}
                                <li class="padding-left_medium">{{ item|richtext }}</li>
                            {% endfor %}
                        </ol>

                    {% elif block.block_type == 'bullet_list' %}
                        <ul class="rich-text w-richtext max-width_large gs-reveal">
                            {% for item in block.value.items %}
                                <li class="padding-left_medium">{{ item|richtext }}</li>
                            {% endfor %}
                        </ul>

                    {% elif block.block_type == 'quote' %}
                        <blockquote class="border-l-4 border-accent-primary padding-left_medium rich-text w-richtext max-width_large gs-reveal">
                            {{ block.value.text|richtext }}
                            {% if block.value.author %}
                                <footer class="text-color_secondary mt-2">— {{ block.value.author }}</footer>
                            {% endif %}
                        </blockquote>

                    {% elif block.block_type == 'embed' %}
                        <div class="image-ratio_auto gs-reveal">
                            {{ block.value.html|safe }}
                        </div>

                    {% elif block.block_type == 'raw_html' %}
                        <div class="rich-text w-richtext max-width_large gs-reveal">
                            {{ block.value|safe }}
                        </div>

                    {% elif block.block_type == 'button' %}
                        <a href="{{ block.value.url }}" class="button is-secondary w-button inline-block px-6 py-3 rounded-lg gs-reveal">
                            {{ block.value.text }}
                        </a>

                    {% elif block.block_type == 'accordion' %}
                        <div class="gs-reveal">
                            {% for item in block.value %}
                                <div class="card on-secondary mb-4">
                                    <button onclick="toggleAccordion('accordion-{{ section.id }}-{{ forloop.counter }}')"
                                            class="accordion-toggle w-full text-left py-4 px-6 rounded-lg flex justify-between items-center hover:bg-gray-850">
                                        <h3 class="heading_h4">{{ item.title }}</h3>
                                        <span class="accordion-icon text-xl">+</span>
                                    </button>
                                    <div id="accordion-{{ section.id }}-{{ forloop.counter }}" class="accordion-content hidden px-6 py-4 rounded-b-lg">
                                        <div class="rich-text w-richtext">{{ item.content|richtext }}</div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                    {% elif block.block_type == 'call_to_action' %}
                        <div class="header is-align-center gs-reveal">
                            <h3 class="heading_h3">{{ block.value.title }}</h3>
                            <div class="rich-text w-richtext max-width_large mb-4">{{ block.value.description|richtext }}</div>
                            <a href="{{ block.value.button_url }}" class="button is-secondary w-button inline-block px-6 py-3 rounded-lg">
                                {{ block.value.button_text }}
                            </a>
                        </div>

                    {% elif block.block_type == 'divider' %}
                        <hr class="border-gray-300 gs-reveal">

                    {% elif block.block_type == 'cards' %}
                        <div class="w-layout-grid grid_3-col gap-xsmall gs-reveal">
                            {% for card in block.value %}
                                <div class="card on-secondary">
                                    <div class="card_body padding-left_medium padding-top_xxsmall">
                                        {% if card.image %}
                                            {% image card.image fill-300x200 class="image_cover image-ratio_auto" %}
                                        {% endif %}
                                        <h3 class="heading_h4 mt-2">{{ card.title }}</h3>
                                        <div class="rich-text w-richtext">{{ card.description|richtext }}</div>
                                        {% if card.button_text and card.button_url %}
                                            <a href="{{ card.button_url }}" class="button is-secondary w-button mt-4 inline-block px-4 py-2 rounded-lg">
                                                {{ card.button_text }}
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                    {% elif block.block_type == 'metrics' %}
                        <div class="w-layout-grid grid_3-col gap-xsmall gs-reveal">
                            {% for item in block.value.items %}
                                <div class="card on-secondary">
                                    <div class="card_body">
                                        {% if item.icon %}
                                            <div class="icon margin-bottom_xsmall">
                                                {% image item.icon fill-48x48 %}
                                            </div>
                                        {% endif %}
                                        <h3 class="heading_h3 counter-element" data-value="{{ item.value }}">{{ item.value }}</h3>
                                        <p class="paragraph_large margin-bottom_none">{{ item.label }}</p>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                    {% endif %}

                {% endfor %}
            </div>
        </section>
    {% endfor %}
<!-- Похожие сервисы -->
{% with other_services=page.get_siblings.live %}
    {% if other_services %}
        <section class="section pt-10">
            <div class="container">
                <!-- Заголовок -->
                <div class="flex items-center justify-between mb-12">
                <h2 class=" heading_h2 text-3xl lg:text-4xl mb-0">Другие продукты</h2>
                <a href="/programms" class="button is-secondary">
                    Все продукты
                    <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </a>
            </div>

                <!-- Сетка карточек -->
                <div class="w-layout-grid grid_3-col gap-2 lg:gap-3 mt-12">
                    {% for service_page in other_services %}
                        {% with service=service_page.specific %}
                            {% if service.id != page.id %}
                                <a href="{{ service.url }}"
                                   class="card relative overflow-hidden rounded-xl group"
                                   style="height: 400px;">
                                    <!-- Фоновое изображение -->
                                    {% if service.hero_image %}
                                        {% image service.hero_image fill-600x400 as bg_img %}
                                        <img src="{{ bg_img.url }}"
                                             alt="{{ service.title }}"
                                             class="w-full h-full object-cover absolute top-0 left-0 z-0 transition-transform duration-1000 group-hover:scale-125">
                                    {% else %}
                                        <!-- Запасной вариант если нет изображения -->
                                        <div class="w-full h-full absolute top-0 left-0 z-0 bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center">
                                            <span class="text-4xl font-bold text-red-500 opacity-50">
                                                {{ service.title|first }}
                                            </span>
                                        </div>
                                    {% endif %}

                                    <!-- Затемнение + контент -->
                                    <div class="relative z-10 flex flex-col justify-between h-full p-6 bg-black/50 text-white">
                                        <!-- Категория -->
                                        <div class="flex items-center justify-between mb-4">
                                            <div></div>
                                            {% if service.category %}
                                                <span class="heading_h5 px-2 py-1 rounded-full bg-red-600/50 text-white text-xs font-medium">
                                                    {{ service.category.name }}
                                                </span>
                                            {% endif %}
                                        </div>

                                        <!-- Заголовок и описание -->
                                        <div class="space-y-3 flex-grow">
                                            <h3 class="heading_h4 text-white group-hover:text-red-400 transition-colors duration-300">
                                                {{ service.title }}
                                            </h3>
                                            {% if service.description %}
                                                <div class=" heading_h5 text-gray-200 ">
                                                    {{ service.description|truncatewords:14|richtext }}
                                                </div>
                                            {% endif %}
                                        </div>

                                        <!-- Цена (если есть) -->
                                        {% if service.price %}
                                            <div class="heading_h5 mt-2 text-white font-semibold">
                                                {{ service.price|intcomma }} руб.
                                            </div>
                                        {% endif %}

                                        <!-- Подробнее + стрелка -->
                                        <div class="heading_h5 mt-auto text-white text-sm font-medium opacity-80 group-hover:opacity-100 group-hover:text-red-400 transition-all duration-300">
                                            Подробнее
                                            <svg class="w-4 h-4 ml-1 inline-block transition-transform duration-300 group-hover:translate-x-1"
                                                 fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </a>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                </div>
            </div>
        </section>
    {% endif %}
{% endwith %}
</article>
    <style>

        /* Стили для таблицы */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            font-size: var(--text-sm, 0.875rem);
            line-height: 1.5;
            padding: var(--spacing-1x, 1rem);
        }

        th {
            background-color: var(--text-primary, #650000e3);
            color: #ffffff;
            font-weight: 600;
        }

        td {
            border-bottom: 1px solid var(--border-secondary, #e5e7eb);
        }

        .body {
            background-color: black;
        }
        
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // GSAP Scroll Animations
            gsap.registerPlugin(ScrollTrigger);
            gsap.utils.toArray('.gs-reveal').forEach(element => {
                gsap.fromTo(element, 
                    { opacity: 0, y: 20 }, 
                    {
                        opacity: 1,
                        y: 0,
                        duration: 0.8,
                        ease: "power2.out",
                        scrollTrigger: {
                            trigger: element,
                            start: "top 95%",
                            end: "bottom 20%",
                            toggleActions: "play none none reverse"
                        }
                    }
                );
            });

          
        });
    </script>


{% endblock %}
