{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block content %}
  <article class="w-full">
    <!-- Hero Section -->
     <h1>{{ page.get_context }}</h1>
    <section class="section is-secondary pt-5 relative min-h-[500px] flex items-center overflow-hidden">
      {% if page.office_image %}
        {% image page.office_image original as bg_image %}
        <div class="absolute inset-0 z-0">
          <img src="{{ bg_image.url }}" alt="{{ page.hero_title }}" class="w-full h-full object-cover top-0 left-0">
          <div class="absolute inset-0 bg-black/30"></div>
        </div>
      {% endif %}
      <div class="container mx-auto px-4 lg:px-8 max-w-7xl relative z-10">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center">
          <div class="space-y-6">
            <h1 class="heading_h1 text-4xl lg:text-5xl font-bold leading-tight mb-6 text-white drop-shadow-md gs-reveal">
              {{ page.hero_title|default:"Карьера" }}
            </h1>
            <p class="heading_h3 text-lg lg:text-xl mb-8 max-w-prose leading-relaxed text-white/90 gs-reveal">
              {{ page.hero_description|richtext|default:"ALMA — команда профессионалов, работающая с крупнейшими нефтегазовыми компаниями в России и за её пределами" }}
            </p>
            <a href="{{ page.hero_about_link|default:'/about/' }}" class="inline-block bg-white text-blue-700 font-semibold px-6 py-3 rounded-lg shadow-lg hover:bg-blue-50 hover:shadow-xl transition-all duration-300 gs-reveal">
              {{ page.hero_about_link_text|default:"Подробнее" }}
            </a>
          </div>
          <div class="space-y-4 gs-reveal">
            <ul class="space-y-2 text-sm text-white/90">
              {% for item in page.hero_service_list_items %}
                <li class="flex items-center">
                  <svg class="w-4 h-4 mr-2 text-green-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                  </svg>
                  {{ item }}
                </li>
              {% empty %}
                <li>IT-компании и ИТ-подразделения</li>
                <li>Промышленные и технологические предприятия</li>
                <li>Организаций, стремящихся повысить эффективность управления</li>
              {% endfor %}
            </ul>
            <ul class="space-y-2 text-sm text-white/90">
              {% for item in page.hero_additional_descriptions_items %}
                <li>{{ item }}</li>
              {% empty %}
                <li>Разрабатываем собственные программные решения для отраслей</li>
                <li>Внедряем ИИ и ML в процессы управления производством, предиктивного анализа, автоматизации</li>
              {% endfor %}
            </ul>
            <div class="grid grid-cols-2 gap-4">
              <div class="text-center space-y-1">
                <div class="counter-element text-2xl font-bold text-white" data-value="{{ page.metric_year_value|add:0|default:2017 }}" data-suffix="">{{ page.metric_year_value|default:"2017" }}</div>
                <div class="text-xs opacity-80 text-white">{{ page.metric_year_label|default:"Год основания компании" }}</div>
              </div>
              <div class="text-center space-y-1">
                <div class="counter-element text-2xl font-bold text-white" data-value="{{ page.metric_projects_value|add:0|default:35 }}" data-suffix="+">{{ page.metric_projects_value|default:"35+" }}</div>
                <div class="text-xs opacity-80 text-white">{{ page.metric_projects_label|default:"Реализованных проектов" }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- What We Do Section (Наши ценности) -->
    <section class="section is-secondary">
      <div class="container mx-auto px-4 lg:px-8 max-w-7xl">
        <div class="w-layout-grid grid_2-col tablet-1-col gap-xxlarge">
          <div class="image-ratio_auto">
            {% if page.office_image %}
              {% image page.office_image fill-400x300 class="image_cover" alt=page.values_title %}
            {% endif %}
          </div>
          <div class="header max-width_large space-y-6">
            <h2 class="heading_h2 gs-reveal">{{ page.values_title|default:"Наши ценности" }}</h2>
            <div class="heading_h5 rich-text w-richtext">
              {% for item in values_items %}
                <div class="mb-6 p-4 border-l-4 border-blue-500 bg-gray-50 rounded-r gs-reveal">
                  <h3 class="text-lg font-semibold mb-2">{{ item.title }}</h3>
                  <p class="text-gray-700">{{ item.description|default:"" }}</p>
                </div>
              {% empty %}
                <div class="mb-6 p-4 border-l-4 border-blue-500 bg-gray-50 rounded-r gs-reveal">
                  <h3 class="text-lg font-semibold mb-2">Вsовлечённость и работа на результат</h3>
                  <p class="text-gray-700">Мы всегда ориентированы на достижение целей и вовлечены в процесс</p>
                </div>
                <div class="mb-6 p-4 border-l-4 border-blue-500 bg-gray-50 rounded-r gs-reveal">
                  <h3 class="text-lg font-semibold mb-2">Инновации и развитие</h3>
                  <p class="text-gray-700">Постоянно внедряем новые технологии для роста</p>
                </div>
                <div class="mb-6 p-4 border-l-4 border-blue-500 bg-gray-50 rounded-r gs-reveal">
                  <h3 class="text-lg font-semibold mb-2">Командная работа</h3>
                  <p class="text-gray-700">Поддерживаем друг друга и делимся знаниями</p>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Expertise Grid (Направления) -->
    <section class="section">
      <div class="container mx-auto px-4 lg:px-8 max-w-7xl">
        <div class="header is-align-center">
          <h2 class="heading_h2 gs-reveal">{{ page.directions_title|default:"Направления" }}</h2>
        </div>
        <div class="w-layout-grid grid_3-col gap-2 lg:gap-3 mt-12">
          {% for item in directions_items %}
            <div class="padding-left_medium divider-vertical padding-top_xxsmall gs-reveal">
              <h3 class="heading_h4 mb-2">{{ item.title }}</h3>
              <p class="text-sm text-gray-600">{{ item.description|default:"" }}</p>
            </div>
          {% empty %}
            <div class="padding-left_medium divider-vertical padding-top_xxsmall gs-reveal">
              <h3 class="heading_h4 mb-2">Проектное управление</h3>
              <p class="text-sm text-gray-600">Координация и контроль проектов</p>
            </div>
            <div class="padding-left_medium divider-vertical padding-top_xxsmall gs-reveal">
              <h3 class="heading_h4 mb-2">Финансовый анализ</h3>
              <p class="text-sm text-gray-600">Анализ и планирование финансов</p>
            </div>
            <div class="padding-left_medium divider-vertical padding-top_xxsmall gs-reveal">
              <h3 class="heading_h4 mb-2">Разработка ПО</h3>
              <p class="text-sm text-gray-600">Создание и поддержка программных решений</p>
            </div>
          {% endfor %}
        </div>
      </div>
    </section>

    <!-- Trust Metrics (Преимущества) -->
    <section class="section is-secondary">
      <div class="container mx-auto px-4 lg:px-8 max-w-7xl">
        <div class="header is-align-center">
          <h2 class="heading_h2 gs-reveal">{{ page.career_title|default:"Карьера в ALMA" }}</h2>
        </div>
        <div class="w-layout-grid grid_5-col tablet-1-col gap-small mt-12">
          {% if page.office_image %}
            <div class="image-ratio_4x3">
              {% image page.office_image fill-736x562 class="image_cover" alt=page.career_title %}
            </div>
          {% endif %}
          <div class="w-layout-grid grid_3-col gap-small">
            {% for item in advantages_items %}
              <div class="card on-secondary gs-reveal">
                <div class="card_body is-y-center">
                  <div class="heading_h3 margin-bottom_none">{{ item|title }}</div>
                  <div class="paragraph_large margin-bottom_none">Преимущество</div>
                </div>
              </div>
            {% empty %}
              <div class="card on-secondary gs-reveal">
                <div class="card_body is-y-center">
                  <div class="heading_h3 margin-bottom_none">Гибкий график работы</div>
                  <div class="paragraph_large margin-bottom_none">Преимущество</div>
                </div>
              </div>
              <div class="card on-secondary gs-reveal">
                <div class="card_body is-y-center">
                  <div class="heading_h3 margin-bottom_none">Возможность удалёнки</div>
                  <div class="paragraph_large margin-bottom_none">Преимущество</div>
                </div>
              </div>
              <div class="card on-secondary gs-reveal">
                <div class="card_body is-y-center">
                  <div class="heading_h3 margin-bottom_none">Конкурентные зарплаты</div>
                  <div class="paragraph_large margin-bottom_none">Преимущество</div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </section>

    <!-- Career Section (Форма) -->
    <section class="section">
      <div class="container mx-auto px-4 lg:px-8 max-w-7xl">
        <div class="w-layout-grid grid_2-col tablet-1-col gap-xxlarge">
          <div class="header max-width_large space-y-6">
            <h2 class="heading_h2 gs-reveal">{{ page.form_title|default:"Хотите в команду?" }}</h2>
            <div class="rich-text w-richtext gs-reveal">
              {{ page.form_description|richtext|default:"Расскажите о своем опыте и кем вы видите себя в ALMA. Оставьте контакты и прикрепите резюме - мы обязательно свяжемся с вами в случае подходящей вакансии." }}
            </div>
             {% include "vacancy/includes/vacancy_form.html" %}
          </div>
          <div class="image-ratio_auto">
            {% if page.office_image %}
              {% image page.office_image fill-400x300 class="image_cover" alt=page.form_title %}
            {% endif %}
          </div>
        </div>
      </div>
    </section>

    <!-- Office Section -->
    <section class="section is-secondary">
      <div class="container mx-auto px-4 lg:px-8 max-w-7xl">
        <div class="header is-align-center mb-12">
          <h2 class="heading_h2 gs-reveal">{{ page.office_title|default:"Наш офис" }}</h2>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          {% if page.office_image %}
            {% image page.office_image fill-600x400 class="image_cover rounded-lg" alt=page.office_title %}
          {% endif %}
          <div class="space-y-4 gs-reveal">
            <p class="text-xl font-semibold">{{ page.office_address|default:"Москва, ул. Примерная, д. 1" }}</p>
            <div id="office-map" class="h-64 bg-gray-200 rounded-lg"></div>
          </div>
        </div>
      </div>
    </section>

    {% include "home/statistics_section.html" %}

  </article>

  <style>
    /* ... (твой оригинальный CSS из примера, без изменений) */
    .image-ratio_1x1 { aspect-ratio: 1 / 1; position: relative; overflow: hidden; border-radius: var(--card-radius, 0.375rem); }
    .image-ratio_auto { aspect-ratio: auto; position: relative; overflow: hidden; border-radius: var(--card-radius, 0.375rem); }
    .w-layout-grid.grid_3-col { grid-template-columns: repeat(3, 1fr); gap: var(--gap-xs, 0.5rem); }
    @media (min-width: 1024px) { .w-layout-grid.grid_3-col { gap: var(--gap-sm, 0.75rem); } }
    .mt-12 { margin-top: var(--spacing-3x, 3rem); }
    .padding-left_medium { padding-left: var(--spacing-3x, 1.5rem); }
    .divider-vertical { border-left: 1px solid var(--border-secondary, #e5e7eb); padding-left: var(--spacing-1-25x, 0.625rem); }
    .padding-top_xxsmall { padding-top: var(--spacing-xxsmall, 0.25rem); }
    .counter-element { transition: color 1s ease; }
    .counter-element.animated { color: var(--accent-color); }
    .animate-on-scroll { animation: countUp 1s ease-out forwards; }
    @keyframes countUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .gs-reveal { opacity: 0; transform: translateY(20px); }
    /* Prose стили из твоего примера */
    .prose { color: #4b5563 !important; max-width: none !important; }
    .prose h2 { color: #1e293b !important; font-weight: 700 !important; font-size: 2rem !important; margin-top: 2rem !important; margin-bottom: 1rem !important; }
    .prose h3 { color: #1e293b !important; font-weight: 600 !important; font-size: 1.5rem !important; margin-top: 1.5rem !important; margin-bottom: 0.75rem !important; }
    .prose p { color: #64748b !important; line-height: 1.75 !important; margin-bottom: 1.25rem !important; }
    .prose ul, .prose ol { color: #64748b !important; padding-left: 2rem !important; margin-bottom: 1.25rem !important; }
    .prose ul li, .prose ol li { margin-bottom: 0.5rem !important; padding-left: 0.5rem !important; }
    .prose blockquote { color: #475569 !important; font-style: italic !important; border-left: 4px solid #3b82f6 !important; padding-left: 1rem !important; margin: 1.5rem 0 !important; }
    .prose a { color: #3b82f6 !important; text-decoration: underline !important; transition: color 0.3s !important; }
    .prose a:hover { color: #2563eb !important; }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      gsap.registerPlugin(ScrollTrigger);
      gsap.utils.toArray('.gs-reveal').forEach(element => {
        gsap.fromTo(element, { opacity: 0, y: 20 }, {
          opacity: 1, y: 0, duration: 0.8, ease: "power2.out",
          scrollTrigger: { trigger: element, start: "top 95%", end: "bottom 20%", toggleActions: "play none none reverse" }
        });
      });

      // Анимация счетчиков
      function animateCounter(element, start, end, duration, suffix = '') {
        let startTime = null;
        function updateCounter(timestamp) {
          if (!startTime) startTime = timestamp;
          const progress = Math.min((timestamp - startTime) / (duration * 1000), 1);
          const currentValue = Math.floor(progress * (end - start) + start);
          element.textContent = currentValue + suffix;
          if (progress < 1) requestAnimationFrame(updateCounter);
          else element.classList.add('animated');
        }
        requestAnimationFrame(updateCounter);
      }
      function isElementInViewport(el) {
        const rect = el.getBoundingClientRect();
        return rect.top <= (window.innerHeight || document.documentElement.clientHeight) * 0.8 && rect.bottom >= 0;
      }
      function handleScroll() {
        document.querySelectorAll('.counter-element').forEach(counter => {
          if (isElementInViewport(counter) && !counter.classList.contains('animated')) {
            const value = parseInt(counter.getAttribute('data-value'));
            const suffix = counter.getAttribute('data-suffix') || '';
            animateCounter(counter, 0, value, 2, suffix);
          }
        });
      }
      window.addEventListener('scroll', handleScroll);
      handleScroll();
    });
  </script>

  <script async defer src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap"></script>
  <script>
    function initMap() {
      const officeMap = new google.maps.Map(document.getElementById('office-map'), {
        zoom: 15, center: { lat: 55.7558, lng: 37.6176 }
      });
      new google.maps.Marker({ position: { lat: 55.7558, lng: 37.6176 }, map: officeMap, title: '{{ page.office_address }}' });
    }
  </script>
{% endblock %}