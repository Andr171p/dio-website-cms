{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block content %}
  <article class="w-full">
    

    <!-- Hero Section -->
    <section class="section is-secondary pt-5 relative min-h-[500px] flex items-center overflow-hidden">
      {% if page.hero_image %}
        {% image page.hero_image original as bg_image %}
        <div class="absolute inset-0 z-0">
          <img src="{{ bg_image.url }}" alt="{{ page.hero_title }}" class="w-full h-full object-cover top-0 left-0">
          <div class="absolute inset-0 bg-black/30"></div>
        </div>
      {% endif %}
      <div class="container mx-auto px-4 lg:px-8 max-w-7xl relative z-10">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center">
          <div class="space-y-6">
            <h1 class="heading_h1 text-4xl lg:text-5xl font-bold leading-tight mb-6 text-white drop-shadow-md gs-reveal">
              {{ page.hero_title }}
            </h1>
            {% if page.hero_description_1 %}
              <p class="heading_h3 text-lg lg:text-xl mb-8 max-w-prose leading-relaxed text-white/90 gs-reveal">
                {{ page.hero_description_1|striptags }}
              </p>
            {% endif %}
            {% if page.hero_button_text and page.hero_button_link %}
              <a href="{{ page.hero_button_link }}" class="inline-block bg-white text-blue-700 font-semibold px-6 py-3 rounded-lg shadow-lg hover:bg-blue-50 hover:shadow-xl transition-all duration-300 gs-reveal">
                {{ page.hero_button_text }}
              </a>
            {% endif %}
          </div>
          <div></div>
        </div>
      </div>
    </section>

    <!-- What We Do Section -->
    <section class="section is-secondary">
      <div class="container mx-auto px-4 lg:px-8 max-w-7xl">
        <div class="w-layout-grid grid_2-col tablet-1-col gap-xxlarge">
          <div class="image-ratio_auto">
            {% if page.hero_image %}
              {% image page.hero_image fill-400x300 class="image_cover" alt=page.hero_title %}
            {% endif %}
          </div>
          <div class="header max-width_large space-y-6">
            <h2 class="heading_h2 gs-reveal">{{ page.approach_title }}</h2>
            <div class="heading_h5 rich-text w-richtext">
              {% if page.approach_description_1 %}
                {{ page.approach_description_1|richtext }}
              {% endif %}
              {% if page.approach_description_2 %}
                {{ page.approach_description_2|richtext }}
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Expertise Grid -->
    <section class="section">
      <div class="container mx-auto px-4 lg:px-8 max-w-7xl">
        <div class="header is-align-center">
          <h2 class="heading_h2 gs-reveal">{{ page.industries_title }}</h2>
        </div>
        <div class="w-layout-grid grid_3-col gap-2 lg:gap-3 mt-12">
          {% if page.industry_01 %}<div class="padding-left_medium divider-vertical padding-top_xxsmall gs-reveal"><h3 class="heading_h4">{{ page.industry_01 }}</h3></div>{% endif %}
          {% if page.industry_02 %}<div class="padding-left_medium divider-vertical padding-top_xxsmall gs-reveal"><h3 class="heading_h4">{{ page.industry_02 }}</h3></div>{% endif %}
          {% if page.industry_03 %}<div class="padding-left_medium divider-vertical padding-top_xxsmall gs-reveal"><h3 class="heading_h4">{{ page.industry_03 }}</h3></div>{% endif %}
          {% if page.industry_04 %}<div class="padding-left_medium divider-vertical padding-top_xxsmall gs-reveal"><h3 class="heading_h4">{{ page.industry_04 }}</h3></div>{% endif %}
          {% if page.industry_05 %}<div class="padding-left_medium divider-vertical padding-top_xxsmall gs-reveal"><h3 class="heading_h4">{{ page.industry_05 }}</h3></div>{% endif %}
          {% if page.industry_06 %}<div class="padding-left_medium divider-vertical padding-top_xxsmall gs-reveal"><h3 class="heading_h4">{{ page.industry_06 }}</h3></div>{% endif %}
        </div>
      </div>
    </section>

    <!-- Trust Metrics -->
<section class="section is-secondary">
  <div class="container mx-auto px-4 lg:px-8 max-w-7xl">
    <div class="header is-align-center">
      <h2 class="heading_h2 gs-reveal">{{ page.trust_title }}</h2>
    </div>
    <div class="w-layout-grid grid_5-col tablet-1-col gap-small mt-12">
      {% if page.trust_image %}
        <div class="image-ratio_4x3">
          {% image page.trust_image fill-736x562 class="image_cover" alt=page.trust_title %}
        </div>
      {% endif %}
      <div class="w-layout-grid grid_2-col gap-small">
        <div class="card on-secondary">
          <div class="card_body is-y-center">
            <div class="heading_h3 margin-bottom_none">{{ page.metric_year_value }}</div>
            <div class="paragraph_large margin-bottom_none">{{ page.metric_year_label }}</div>
          </div>
        </div>
        <div class="card on-secondary">
          <div class="card_body is-y-center">
            <div class="heading_h3 margin-bottom_none">{{ page.metric_projects_value }}</div>
            <div class="paragraph_large margin-bottom_none">{{ page.metric_projects_label }}</div>
          </div>
        </div>
        <div class="card on-secondary">
          <div class="card_body is-y-center">
            <div class="heading_h3 margin-bottom_none">{{ page.metric_presence_value }}</div>
            <div class="paragraph_large margin-bottom_none">{{ page.metric_presence_label }}</div>
          </div>
        </div>
        <!-- Добавьте дополнительные карточки, если нужно -->
      </div>
    </div>
  </div>
</section>

    <!-- Career Section -->
    <section class="section">
      <div class="container mx-auto px-4 lg:px-8 max-w-7xl">
        <div class="w-layout-grid grid_2-col tablet-1-col gap-xxlarge">
          <div class="header max-width_large space-y-6">
            <h2 class="heading_h2 gs-reveal">{{ page.career_title }}</h2>
            {% if page.career_description %}
              <div class="rich-text w-richtext">
                {{ page.career_description|richtext }}
              </div>
            {% endif %}
            {% if page.career_button_text and page.career_button_link %}
              <a href="{{ page.career_button_link }}" class="button is-secondary w-button gs-reveal">
                {{ page.career_button_text }}
              </a>
            {% endif %}
          </div>
          <div class="image-ratio_auto">
            {% if page.hero_image %}
              {% image page.hero_image fill-400x300 class="image_cover" alt=page.career_title %}
            {% endif %}
          </div>
        </div>
      </div>
    </section>

{% include "home/statistics_section.html"  %}


  </article>

  <style>
    .image-ratio_1x1 {
      aspect-ratio: 1 / 1;
      position: relative;
      overflow: hidden;
      border-radius: var(--card-radius, 0.375rem);
    }

    .image-ratio_auto {
      aspect-ratio: auto;
      position: relative;
      overflow: hidden;
      border-radius: var(--card-radius, 0.375rem);
    }

    .w-layout-grid.grid_3-col {
      grid-template-columns: repeat(3, 1fr);
      gap: var(--gap-xs, 0.5rem);
    }

    @media (min-width: 1024px) {
      .w-layout-grid.grid_3-col {
        gap: var(--gap-sm, 0.75rem);
      }
    }

    .mt-12 {
      margin-top: var(--spacing-3x, 3rem);
    }

    .padding-left_medium {
      padding-left: var(--spacing-3x, 1.5rem);
    }

    .divider-vertical {
      border-left: 1px solid var(--border-secondary, #e5e7eb);
      padding-left: var(--spacing-1-25x, 0.625rem);
    }

    .padding-top_xxsmall {
      padding-top: var(--spacing-xxsmall, 0.25rem);
    }

    .prose {
      color: #4b5563 !important;
      max-width: none !important;
    }
    .prose h2 {
      color: #1e293b !important;
      font-weight: 700 !important;
      font-size: 2rem !important;
      margin-top: 2rem !important;
      margin-bottom: 1rem !important;
    }
    .prose h3 {
      color: #1e293b !important;
      font-weight: 600 !important;
      font-size: 1.5rem !important;
      margin-top: 1.5rem !important;
      margin-bottom: 0.75rem !important;
    }
    .prose p {
      color: #64748b !important;
      line-height: 1.75 !important;
      margin-bottom: 1.25rem !important;
    }
    .prose ul, .prose ol {
      color: #64748b !important;
      padding-left: 2rem !important;
      margin-bottom: 1.25rem !important;
    }
    .prose ul li, .prose ol li {
      margin-bottom: 0.5rem !important;
      padding-left: 0.5rem !important;
    }
    .prose blockquote {
      color: #475569 !important;
      font-style: italic !important;
      border-left: 4px solid #3b82f6 !important;
      padding-left: 1rem !important;
      margin: 1.5rem 0 !important;
    }
    .prose a {
      color: #3b82f6 !important;
      text-decoration: underline !important;
      transition: color 0.3s !important;
    }
    .prose a:hover {
      color: #2563eb !important;
    }

    /* Скрываем элементы до анимации */
    .gs-reveal {
      opacity: 0;
      transform: translateY(20px);
    }

    /* Стили для счетчиков статистики */
    .counter-element {
      transition: color 1s ease;
    }

    .counter-element.animated {
      color: var(--accent-color);
    }

    .animate-on-scroll {
      animation: countUp 1s ease-out forwards;
    }

    /* Анимация счетчиков */
    @keyframes countUp {
      from { 
        opacity: 0;
        transform: translateY(20px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      gsap.registerPlugin(ScrollTrigger);

      // Анимация появления элементов при прокрутке
      gsap.utils.toArray('.gs-reveal').forEach(element => {
        gsap.fromTo(element, 
          { opacity: 0, y: 20 }, 
          {
            opacity: 1,
            y: 0,
            duration: 0.8,
            ease: "power2.out",
            scrollTrigger: {
              trigger: element,
              start: "top 95%", // Анимация начинается, когда верх элемента достигает 80% от верха экрана
              end: "bottom 20%",
              toggleActions: "play none none reverse" // Плавное появление и исчезновение при скроллинге
            }
          }
        );
      });
    });

    document.addEventListener('DOMContentLoaded', function() {
      // Функция для анимации счетчиков
      function animateCounter(element, start, end, duration, suffix = '') {
        let startTime = null;
        
        function updateCounter(timestamp) {
          if (!startTime) startTime = timestamp;
          const progress = Math.min((timestamp - startTime) / (duration * 500), 1);
          const currentValue = Math.floor(progress * (end - start) + start);
          element.textContent = currentValue + suffix;
          
          if (progress < 1) {
            requestAnimationFrame(updateCounter);
          } else {
            element.classList.add('animated');
          }
        }
        
        requestAnimationFrame(updateCounter);
      }

      // Функция для проверки видимости элемента
      function isElementInViewport(el) {
        const rect = el.getBoundingClientRect();
        return (
          rect.top <= (window.innerHeight || document.documentElement.clientHeight) * 0.8 &&
          rect.bottom >= 0
        );
      }

      // Запуск анимации при скролле
      function handleScroll() {
        const counters = document.querySelectorAll('.counter-element');
        counters.forEach(counter => {
          if (isElementInViewport(counter) && !counter.classList.contains('animated')) {
            const value = parseInt(counter.getAttribute('data-value'));
            const suffix = counter.getAttribute('data-suffix') || '';
            counter.classList.add('animate-on-scroll');
            animateCounter(counter, 0, value, 2, suffix);
          }
        });
      }

      // Проверяем при загрузке и при скролле
      window.addEventListener('scroll', handleScroll);
      handleScroll(); // Проверить сразу при загрузке
    });
  </script>

  <style>
.counter-element {
    transition: color 1s ease;
}

.counter-element.animated {
    color: var(--accent-color);
}


.animate-on-scroll {
    animation: countUp 1s ease-out forwards;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Функция для анимации счетчиков
    function animateCounter(element, start, end, duration, suffix = '') {
        let startTime = null;
        
        function updateCounter(timestamp) {
            if (!startTime) startTime = timestamp;
            const progress = Math.min((timestamp - startTime) / (duration * 500), 1);
            const currentValue = Math.floor(progress * (end - start) + start);
            element.textContent = currentValue + suffix;
            
            if (progress < 1) {
                requestAnimationFrame(updateCounter);
            } else {
                element.classList.add('animated');
            }
        }
        
        requestAnimationFrame(updateCounter);
    }

    // Функция для проверки видимости элемента
    function isElementInViewport(el) {
        const rect = el.getBoundingClientRect();
        return (
            rect.top <= (window.innerHeight || document.documentElement.clientHeight) * 0.8 &&
            rect.bottom >= 0
        );
    }

    // Запуск анимации при скролле
    function handleScroll() {
        const counters = document.querySelectorAll('.counter-element');
        counters.forEach(counter => {
            if (isElementInViewport(counter) && !counter.classList.contains('animated')) {
                const value = parseInt(counter.getAttribute('data-value'));
                const suffix = counter.getAttribute('data-suffix') || '';
                counter.classList.add('animate-on-scroll');
                animateCounter(counter, 0, value, 2, suffix);
            }
        });
    }

    // Проверяем при загрузке и при скролле
    window.addEventListener('scroll', handleScroll);
    handleScroll(); // Проверить сразу при загрузке
});
</script>


{% endblock %}